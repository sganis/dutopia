import"../chunks/Bzak7iHL.js";import{R as V,S as y,Y as a,V as P,N as o,W as g,Z as t,_ as f,ak as C,ao as W,ap as E,a9 as u,X,an as F,$ as Y,aq as G,u as H,am as K,al as Q,T as ee,ar as te}from"../chunks/CZTrrgyc.js";import{i as D}from"../chunks/CXUUFbzq.js";import{e as ae,s as se,i as re,g as oe,r as B,b as M,t as ie,A as ne,S as n,a as z}from"../chunks/DnbAJzvI.js";const le=!1,Ae=Object.freeze(Object.defineProperty({__proto__:null,ssr:le},Symbol.toStringTag,{value:"Module"})),de=""+new URL("../assets/disk_usage.D6y1m4ri.svg",import.meta.url).href,ve=_=>_;function ce(_,{delay:b=0,duration:c=400,easing:x=ve}={}){const l=+getComputedStyle(_).opacity;return{delay:b,duration:c,easing:x,css:d=>`opacity: ${d*l}`}}var pe=y('<div class="w-10 h-2"></div>'),ue=y('<span class="animate-spin border-2 border-t-transparent rounded-full w-5 h-5 inline-block"></span>'),fe=y('<p class="w-1/2 bg-red-100 text-red-700 p-2 rounded text-sm text-center"> </p>'),me=y(`<div class="flex flex-col gap-4 justify-center items-center h-full text-white"><div class="flex w-full"></div> <div class="flex flex-col gap-4 w-1/2 mt-20 items-center justify-center"><div class="flex flex-col gap-2 p-6 border w-1/2 min-w-80
            items-center justify-center
            border-gray-500 bg-gray-800 rounded-lg shadow-lg "><form class="space-y-4 w-full"><div><label class="block text-sm font-medium" for="username">Username</label> <input class="w-full" id="username" placeholder="Linux user" type="text" required/></div> <div><label class="block text-sm font-medium " for="password">Password</label> <input class="w-full" id="password" placeholder="Linux password" type="password" required/></div> <div class="flex items-right justify-end"><button class="btn w-full" type="submit"><!></button></div></form></div></div> <!> <div class="grow"></div></div>`);function ge(_,b){V(b,!0);let c=C(void 0),x=C(void 0),l=C(void 0),d=C(""),j=`${ne}/login`;function I(e){try{let v=(e.split(".")[1]||"").replace(/-/g,"+").replace(/_/g,"/");const S=v.length%4;S&&(v+="=".repeat(4-S));const i=atob(v);return JSON.parse(i)}catch{return{}}}const J=async e=>{try{u(l,!0),u(d,"");const s=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({username:o(c),password:o(x)})}),v=await s.json().catch(()=>({}));if(s.ok){const S=v.access_token;if(!S){u(d,"Malformed server response (missing token).");return}const i=I(S);console.log("claims:",i);const we=i!=null&&i.exp?i.exp*1e3:null;n.username=(i==null?void 0:i.sub)||o(c),n.isAdmin=!!(i!=null&&i.is_admin),n.token=S,localStorage.setItem("state",JSON.stringify(n))}else u(d,v.error||v.detail||"Invalid credentials",!0)}catch(s){console.error(s),u(d,"Network error. Please try again.")}finally{u(x,""),u(l,!1)}};var w=me(),A=a(w);ae(A,21,()=>oe(30),re,(e,s)=>{var v=pe();P(()=>se(v,`background: ${o(s)??""}`)),g(e,v)}),t(A);var h=f(A,2),T=a(h),L=a(T),O=a(L),r=f(a(O),2);B(r),t(O);var p=f(O,2),m=f(a(p),2);B(m),t(p);var q=f(p,2),k=a(q),R=a(k);{var U=e=>{var s=ue();g(e,s)},N=e=>{var s=F("Log in");g(e,s)};D(R,e=>{o(l)?e(U):e(N,!1)})}t(k),t(q),t(L),t(T),t(h);var $=f(h,2);{var Z=e=>{var s=fe(),v=a(s,!0);t(s),P(()=>Y(v,o(d))),g(e,s)};D($,e=>{o(d)&&e(Z)})}W(2),t(w),P(()=>{r.disabled=o(l),m.disabled=o(l),k.disabled=o(l)}),E("submit",L,J),M(r,()=>o(c),e=>u(c,e)),M(m,()=>o(x),e=>u(x,e)),ie(1,w,()=>ce,()=>({duration:500})),g(_,w),X()}function _e(_,b){b()}var be=y('<span class="px-2 py-1 rounded bg-emerald-600 text-white">Admin</span>'),xe=y('<div class="flex items-center gap-3 text-sm"><span class="opacity-80"> </span> <!> <button class="px-3 py-1 rounded bg-gray-700 hover:bg-gray-600">Logout</button></div>'),ye=y('<div class="flex flex-col h-screen min-h-0 overflow-hidden"><div class="flex items-center justify-between p-4 text-xl border-b border-gray-500 text-gray-200 select-none"><div class="flex gap-2 items-center"><div><img alt="logo"/></div> <div>Dutopia 3.0</div></div> <div class="grow"></div> <!></div> <div class="flex flex-col h-full overflow-hidden p-2 bg-[var(--color)]"><!></div></div>');function Le(_,b){V(b,!0);let c=K(()=>!!n.token&&(!n.expiresAt||Date.now()<n.expiresAt));H(()=>{u(c,!!n.token&&(!n.expiresAt||Date.now()<n.expiresAt))});function x(){n.logout(),localStorage.removeItem("state")}var l=ye(),d=a(l),j=a(d),I=a(j),J=a(I);z(J,"width",28),t(I),W(2),t(j);var w=f(j,4);{var A=r=>{var p=xe(),m=a(p),q=a(m,!0);t(m);var k=f(m,2);{var R=N=>{var $=be();g(N,$)};D(k,N=>{n.isAdmin&&N(R)})}var U=f(k,2);U.__click=[_e,x],t(p),P(()=>Y(q,n.username)),g(r,p)};D(w,r=>{o(c)&&r(A)})}t(d);var h=f(d,2),T=a(h);{var L=r=>{var p=Q(),m=ee(p);te(m,()=>b.children),g(r,p)},O=r=>{ge(r,{})};D(T,r=>{o(c)?r(L):r(O,!1)})}t(h),t(l),P(()=>z(J,"src",de)),g(_,l),X()}G(["click"]);export{Le as component,Ae as universal};
//# sourceMappingURL=0.qSoSr05X.js.map
