import"../chunks/Bzak7iHL.js";import{a8 as Q,a9 as y,ae as t,ab as I,Q as o,ac as g,af as a,ag as f,ai as U,aj as W,ak as H,W as u,ad as E,al as K,ah as F,am as V,u as X,an as Y,ao as Z,aa as ee,ap as ae}from"../chunks/Do7IxGTj.js";import{i as J}from"../chunks/DosZytHh.js";import{e as te,s as se,i as re,g as oe,r as R,b as $,t as ie,A as ne,S as n,a as z}from"../chunks/CbcBQ_vm.js";const le=!1,Ae=Object.freeze(Object.defineProperty({__proto__:null,ssr:le},Symbol.toStringTag,{value:"Module"})),de=""+new URL("../assets/disk_usage.D6y1m4ri.svg",import.meta.url).href,ve=_=>_;function ce(_,{delay:b=0,duration:c=400,easing:x=ve}={}){const l=+getComputedStyle(_).opacity;return{delay:b,duration:c,easing:x,css:d=>`opacity: ${d*l}`}}var pe=y('<div class="w-10 h-2"></div>'),ue=y('<span class="animate-spin border-2 border-t-transparent rounded-full w-5 h-5 inline-block"></span>'),fe=y('<p class="w-1/2 bg-red-100 text-red-700 p-2 rounded text-sm text-center"> </p>'),me=y(`<div class="flex flex-col gap-4 justify-center items-center h-full text-white"><div class="flex gap-1"></div> <div class="flex flex-col gap-4 w-1/2 mt-20 items-center justify-center"><div class="flex flex-col gap-2 p-6 border w-full
            items-center justify-center
            border-gray-500 bg-gray-800 rounded-lg shadow-lg "><form class="space-y-4 w-full"><div><label class="block text-sm font-medium" for="username">Username</label> <input class="w-full" id="username" placeholder="Linux user" type="text" required/></div> <div><label class="block text-sm font-medium " for="password">Password</label> <input class="w-full" id="password" placeholder="Linux password" type="password" required/></div> <div class="flex items-right justify-end"><button class="btn w-full" type="submit"><!></button></div></form></div></div> <!> <div class="grow"></div></div>`);function ge(_,b){Q(b,!0);let c=U(void 0),x=U(void 0),l=U(void 0),d=U(""),j=`${ne}/login`;function N(e){try{let v=(e.split(".")[1]||"").replace(/-/g,"+").replace(/_/g,"/");const S=v.length%4;S&&(v+="=".repeat(4-S));const i=atob(v);return JSON.parse(i)}catch{return{}}}const C=async e=>{try{u(l,!0),u(d,"");const s=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({username:o(c),password:o(x)})}),v=await s.json().catch(()=>({}));if(s.ok){const S=v.access_token;if(!S){u(d,"Malformed server response (missing token).");return}const i=N(S);console.log("claims:",i);const we=i!=null&&i.exp?i.exp*1e3:null;n.username=(i==null?void 0:i.sub)||o(c),n.isAdmin=!!(i!=null&&i.is_admin),n.token=S,localStorage.setItem("state",JSON.stringify(n))}else u(d,v.error||v.detail||"Invalid credentials",!0)}catch(s){console.error(s),u(d,"Network error. Please try again.")}finally{u(x,""),u(l,!1)}};var w=me(),A=t(w);te(A,21,()=>oe(20),re,(e,s)=>{var v=pe();I(()=>se(v,`background: ${o(s)??""}`)),g(e,v)}),a(A);var h=f(A,2),D=t(h),L=t(D),O=t(L),r=f(t(O),2);R(r),a(O);var p=f(O,2),m=f(t(p),2);R(m),a(p);var T=f(p,2),k=t(T),q=t(k);{var B=e=>{var s=ue();g(e,s)},P=e=>{var s=K("Log in");g(e,s)};J(q,e=>{o(l)?e(B):e(P,!1)})}a(k),a(T),a(L),a(D),a(h);var M=f(h,2);{var G=e=>{var s=fe(),v=t(s,!0);a(s),I(()=>F(v,o(d))),g(e,s)};J(M,e=>{o(d)&&e(G)})}W(2),a(w),I(()=>{r.disabled=o(l),m.disabled=o(l),k.disabled=o(l)}),H("submit",L,C),$(r,()=>o(c),e=>u(c,e)),$(m,()=>o(x),e=>u(x,e)),ie(1,w,()=>ce,()=>({duration:500})),g(_,w),E()}function _e(_,b){b()}var be=y('<span class="px-2 py-1 rounded bg-emerald-600 text-white">Admin</span>'),xe=y('<div class="flex items-center gap-3 text-sm"><span class="opacity-80"> </span> <!> <button class="px-3 py-1 rounded bg-gray-700 hover:bg-gray-600">Logout</button></div>'),ye=y('<div class="flex flex-col h-screen min-h-0 overflow-hidden"><div class="flex items-center justify-between p-4 text-xl border-b border-gray-500 text-gray-200 select-none"><div class="flex gap-2 items-center"><div><img alt="logo"/></div> <div>Statwalker 2.0</div></div> <div class="grow"></div> <!></div> <div class="flex flex-col h-full overflow-hidden p-2 bg-[var(--color)]"><!></div></div>');function Le(_,b){Q(b,!0);let c=Y(()=>!!n.token&&(!n.expiresAt||Date.now()<n.expiresAt));X(()=>{u(c,!!n.token&&(!n.expiresAt||Date.now()<n.expiresAt))});function x(){n.logout(),localStorage.removeItem("state")}var l=ye(),d=t(l),j=t(d),N=t(j),C=t(N);z(C,"width",28),a(N),W(2),a(j);var w=f(j,4);{var A=r=>{var p=xe(),m=t(p),T=t(m,!0);a(m);var k=f(m,2);{var q=P=>{var M=be();g(P,M)};J(k,P=>{n.isAdmin&&P(q)})}var B=f(k,2);B.__click=[_e,x],a(p),I(()=>F(T,n.username)),g(r,p)};J(w,r=>{o(c)&&r(A)})}a(d);var h=f(d,2),D=t(h);{var L=r=>{var p=Z(),m=ee(p);ae(m,()=>b.children),g(r,p)},O=r=>{ge(r,{})};J(D,r=>{o(c)?r(L):r(O,!1)})}a(h),a(l),I(()=>z(C,"src",de)),g(_,l),E()}V(["click"]);export{Le as component,Ae as universal};
//# sourceMappingURL=0.CRfh0xKi.js.map
